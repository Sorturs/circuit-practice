<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuit Master: Visual Physics Lab</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #4f46e5;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text: #1e293b;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { margin: 0; font-size: 1.8rem; }
        p.subtitle { margin: 0.5rem 0 0; opacity: 0.9; }

        /* Navigation */
        nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e2e8f0;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            background: transparent;
            color: var(--text);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }

        /* Main Content */
        main {
            flex: 1;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .section { display: none; animation: fadeIn 0.3s ease-in; }
        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Concept Cards */
        .concept-card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
        }

        .analogy-box {
            background: #eff6ff;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-style: italic;
            border: 1px dashed var(--primary);
        }

        /* Interactive Circuit Area */
        .game-container {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-align: center;
        }

        .circuit-visual {
            background: #1e293b; /* Dark board */
            padding: 2rem;
            position: relative;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        svg {
            width: 100%;
            height: 100%;
            max-width: 500px;
        }

        /* Circuit Elements */
        .wire { stroke: #cbd5e1; stroke-width: 4; fill: none; stroke-linecap: round; }
        .resistor { stroke: #f59e0b; stroke-width: 6; fill: none; stroke-linecap: round; }
        .battery { stroke: #ef4444; stroke-width: 6; }
        .label-bg { fill: #1e293b; opacity: 0.8; }
        .label-text { fill: #ffffff; font-family: monospace; font-size: 14px; font-weight: bold; }
        .highlight-text { fill: #f59e0b; font-weight: bold; font-size: 16px; }

        .controls {
            padding: 2rem;
        }

        .input-group {
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
        }

        input[type="number"] {
            padding: 0.75rem;
            font-size: 1.2rem;
            width: 100px;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            text-align: center;
        }

        button.action-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
        }
        
        button.action-btn:active { transform: scale(0.98); }

        .feedback-area {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            display: none;
        }
        
        .feedback-area.correct { background: #dcfce7; color: #166534; display: block; }
        .feedback-area.wrong { background: #fee2e2; color: #991b1b; display: block; }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 2rem;
            background: #f1f5f9;
            font-size: 0.9rem;
            color: #64748b;
        }
    </style>
</head>
<body>

<header>
    <h1>‚ö° Circuit Master</h1>
    <p class="subtitle">Grade 9 Physics: Series & Parallel Analysis</p>
</header>

<nav>
    <button class="nav-btn active" onclick="switchTab('learn')">üìò Learn Concepts</button>
    <button class="nav-btn" onclick="switchTab('practice')">üéÆ Practice Lab</button>
</nav>

<main>
    <!-- LEARN SECTION -->
    <div id="learn" class="section active">
        
        <!-- Series Concept -->
        <div class="concept-card">
            <h2 style="color: var(--primary);">1. The Series Circuit (The Single Road)</h2>
            <p>In a series circuit, there is only <strong>one path</strong> for electrons to flow.</p>
            
            <div style="display:flex; gap: 20px; align-items:center; flex-wrap: wrap;">
                <svg width="200" height="150" viewBox="0 0 200 150" style="background:#1e293b; border-radius:8px;">
                    <!-- Simple Series Icon -->
                    <rect x="20" y="40" width="160" height="70" class="wire" />
                    <line x1="18" x2="18" y1="65" y2="85" class="battery" /> <!-- Batt -->
                    <line x1="24" x2="24" y1="55" y2="95" class="battery" />
                    <line x1="70" x2="90" y1="40" y2="40" class="resistor" stroke-dasharray="5,2" /> <!-- R1 -->
                    <line x1="110" x2="130" y1="110" y2="110" class="resistor" stroke-dasharray="5,2" /> <!-- R2 -->
                    <!-- Arrows -->
                    <path d="M 50 40 L 60 40 L 55 35 M 60 40 L 55 45" stroke="white" fill="none" />
                </svg>
                <div style="flex:1;">
                    <ul style="list-style: none; padding:0;">
                        <li><strong>‚ö° Current (<b>I</b>):</strong> Is the <u>SAME</u> everywhere. <br><code style="background:#e0e7ff; padding:2px 5px;">I<sub>total</sub> = I<sub>1</sub> = I<sub>2</sub></code></li>
                        <li style="margin-top:10px;"><strong>üîã Voltage (<b>V</b>):</strong> <u>SPLITS</u> between loads. <br><code style="background:#fff7ed; padding:2px 5px;">V<sub>total</sub> = V<sub>1</sub> + V<sub>2</sub></code></li>
                    </ul>
                </div>
            </div>

            <div class="analogy-box">
                üöó <strong>Analogy:</strong> Think of a single-lane road. If 50 cars leave the start, 50 cars must pass every point. There are no shortcuts! The "energy" (gas) they use is split between driving up hill 1 and hill 2.
            </div>
        </div>

        <!-- Parallel Concept -->
        <div class="concept-card" style="border-left-color: var(--accent);">
            <h2 style="color: var(--accent);">2. The Parallel Circuit (The Split River)</h2>
            <p>In a parallel circuit, the path <strong>branches out</strong>. Electrons have choices.</p>
            
            <div style="display:flex; gap: 20px; align-items:center; flex-wrap: wrap;">
                <svg width="200" height="150" viewBox="0 0 200 150" style="background:#1e293b; border-radius:8px;">
                    <!-- Simple Parallel Icon -->
                    <line x1="20" x2="60" y1="75" y2="75" class="wire" /> <!-- Left -->
                    <line x1="140" x2="180" y1="75" y2="75" class="wire" /> <!-- Right -->
                    <line x1="60" x2="60" y1="40" y2="110" class="wire" /> <!-- Split Vert -->
                    <line x1="140" x2="140" y1="40" y2="110" class="wire" /> <!-- Join Vert -->
                    
                    <line x1="60" x2="140" y1="40" y2="40" class="wire" /> <!-- Top Branch -->
                    <line x1="60" x2="140" y1="110" y2="110" class="wire" /> <!-- Bot Branch -->

                    <line x1="24" x2="24" y1="65" y2="85" class="battery" /> <!-- Batt -->
                    <line x1="30" x2="30" y1="55" y2="95" class="battery" />

                    <line x1="90" x2="110" y1="40" y2="40" class="resistor" stroke-dasharray="5,2" /> <!-- R1 -->
                    <line x1="90" x2="110" y1="110" y2="110" class="resistor" stroke-dasharray="5,2" /> <!-- R2 -->
                </svg>
                <div style="flex:1;">
                    <ul style="list-style: none; padding:0;">
                        <li><strong>‚ö° Current (<b>I</b>):</strong> <u>SPLITS</u> into branches. <br><code style="background:#e0e7ff; padding:2px 5px;">I<sub>total</sub> = I<sub>1</sub> + I<sub>2</sub></code></li>
                        <li style="margin-top:10px;"><strong>üîã Voltage (<b>V</b>):</strong> Is the <u>SAME</u> for each branch. <br><code style="background:#fff7ed; padding:2px 5px;">V<sub>total</sub> = V<sub>1</sub> = V<sub>2</sub></code></li>
                    </ul>
                </div>
            </div>

            <div class="analogy-box">
                ‚õ∑Ô∏è <strong>Analogy:</strong> Think of a ski hill with two different runs (Green and Black Diamond). Both runs start at the top and end at the bottom (same height/Voltage drop). But the skiers (Current) split up; some go left, some go right.
            </div>
        </div>
        
        <button class="action-btn" style="width:100%" onclick="switchTab('practice')">I'm Ready to Practice! ‚Üí</button>
    </div>

    <!-- PRACTICE SECTION -->
    <div id="practice" class="section">
        <div class="game-container">
            <div class="stats-bar">
                <span>Streak: <strong id="streak-display">0</strong> üî•</span>
                <span id="mode-badge">SERIES MODE</span>
            </div>

            <div class="circuit-visual" id="circuit-canvas">
                <!-- SVG injected by JS -->
            </div>

            <div class="controls">
                <h3 id="question-text">Find the missing value (?)</h3>
                
                <div class="input-group">
                    <span style="font-size: 1.5rem; font-weight:bold;" id="input-label">V‚ÇÇ = </span>
                    <input type="number" id="user-input" placeholder="?" onkeydown="if(event.key==='Enter') checkAnswer()">
                    <span style="font-size: 1.2rem; color: #64748b;" id="unit-label">V</span>
                </div>

                <button class="action-btn" onclick="checkAnswer()">Check Answer</button>

                <div id="feedback-box" class="feedback-area">
                    <!-- Feedback injected here -->
                </div>
                
                <button id="next-btn" class="action-btn" style="background:var(--primary); display:none; margin-top:10px;" onclick="generateProblem()">Next Challenge ‚Üí</button>
            </div>
        </div>
    </div>
</main>

<script>
    // --- STATE MANAGEMENT ---
    let currentProblem = null;
    let streak = 0;

    // --- NAVIGATION ---
    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        // Find the button that calls this function with this ID - simplification
        const btns = document.querySelectorAll('.nav-btn');
        if(tabId === 'learn') btns[0].classList.add('active');
        else {
            btns[1].classList.add('active');
            if(!currentProblem) generateProblem();
        }
    }

    // --- SVG GENERATORS ---
    function getSeriesSVG(vals, unknownKey) {
        // vals = { vt, v1, v2, it, i1, i2 }
        const getText = (key, label) => {
            if (key === unknownKey) return `${label} = ?`;
            return `${label} = ${vals[key]}`;
        };

        return `
        <svg viewBox="0 0 400 250">
            <!-- Main Loop -->
            <rect x="50" y="50" width="300" height="150" class="wire" rx="10" />
            
            <!-- Battery (Left) -->
            <rect x="40" y="100" width="20" height="50" fill="#1e293b" /> <!-- Hide wire behind -->
            <line x1="40" y1="115" x2="60" y2="115" class="battery" />
            <line x1="40" y1="135" x2="60" y2="135" class="battery" />
            <text x="10" y="125" class="label-text" fill="#ef4444">${getText('vt', 'Vt')}</text>
            <text x="10" y="145" class="label-text" fill="#ef4444">${getText('it', 'It')}</text>

            <!-- Resistor 1 (Top) -->
            <rect x="150" y="40" width="100" height="20" fill="#1e293b" />
            <line x1="150" y1="50" x2="250" y2="50" class="resistor" stroke-dasharray="10,5"/>
            <text x="170" y="30" class="label-text" fill="#f59e0b">${getText('v1', 'V1')}</text>
            <text x="170" y="85" class="label-text" fill="#cbd5e1">${getText('i1', 'I1')}</text>

            <!-- Resistor 2 (Bottom) -->
            <rect x="150" y="190" width="100" height="20" fill="#1e293b" />
            <line x1="150" y1="200" x2="250" y2="200" class="resistor" stroke-dasharray="10,5"/>
            <text x="170" y="235" class="label-text" fill="#f59e0b">${getText('v2', 'V2')}</text>
            <text x="170" y="185" class="label-text" fill="#cbd5e1">${getText('i2', 'I2')}</text>
        </svg>`;
    }

    function getParallelSVG(vals, unknownKey) {
        const getText = (key, label) => {
            if (key === unknownKey) return `${label} = ?`;
            return `${label} = ${vals[key]}`;
        };

        return `
        <svg viewBox="0 0 400 250">
            <!-- Wires -->
            <line x1="50" y1="125" x2="120" y2="125" class="wire" />
            <line x1="280" y1="125" x2="350" y2="125" class="wire" />
            
            <line x1="120" y1="50" x2="120" y2="200" class="wire" /> <!-- Split -->
            <line x1="280" y1="50" x2="280" y2="200" class="wire" /> <!-- Join -->
            
            <line x1="120" y1="50" x2="280" y2="50" class="wire" /> <!-- Top Branch -->
            <line x1="120" y1="200" x2="280" y2="200" class="wire" /> <!-- Bot Branch -->

            <!-- Battery (Left) -->
            <rect x="60" y="110" width="20" height="30" fill="#1e293b" />
            <line x1="70" y1="115" x2="70" y2="135" class="battery" transform="rotate(90 70 125)"/>
            <line x1="80" y1="115" x2="80" y2="135" class="battery" transform="rotate(90 75 125)"/>
            <text x="20" y="110" class="label-text">${getText('vt', 'Vt')}</text>
            <text x="20" y="145" class="label-text">${getText('it', 'It')}</text>

            <!-- Resistor 1 (Top) -->
            <rect x="170" y="40" width="60" height="20" fill="#1e293b" />
            <line x1="170" y1="50" x2="230" y2="50" class="resistor" stroke-dasharray="10,5"/>
            <text x="175" y="35" class="label-text" fill="#f59e0b">${getText('v1', 'V1')}</text>
            <text x="175" y="80" class="label-text" fill="#cbd5e1">${getText('i1', 'I1')}</text>

            <!-- Resistor 2 (Bottom) -->
            <rect x="170" y="190" width="60" height="20" fill="#1e293b" />
            <line x1="170" y1="200" x2="230" y2="200" class="resistor" stroke-dasharray="10,5"/>
            <text x="175" y="235" class="label-text" fill="#f59e0b">${getText('v2', 'V2')}</text>
            <text x="175" y="185" class="label-text" fill="#cbd5e1">${getText('i2', 'I2')}</text>
        </svg>`;
    }

    // --- GAME LOGIC ---
    function generateProblem() {
        // Reset UI
        document.getElementById('feedback-box').style.display = 'none';
        document.getElementById('feedback-box').className = 'feedback-area';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('user-input').value = '';
        
        // Randomize Type: 0 = Series, 1 = Parallel
        const isSeries = Math.random() > 0.5;
        const type = isSeries ? 'Series' : 'Parallel';
        
        // Randomize Variable: 0 = Voltage, 1 = Current
        const isVoltage = Math.random() > 0.5;
        
        // Generate Values
        const valA = Math.floor(Math.random() * 10) + 2; // e.g., Resistor 1
        const valB = Math.floor(Math.random() * 10) + 2; // e.g., Resistor 2
        let total, v1, v2, i1, i2, it;
        
        // Store problem logic
        let targetKey, targetVal, label, unit;
        let knownValues = {}; // formatted text for display
        let explanation = "";

        if (isSeries) {
            // Series Logic
            if (isVoltage) {
                // V adds up
                v1 = valA; v2 = valB; total = v1 + v2;
                // Decide unknown
                const unknown = Math.random();
                if (unknown < 0.33) { 
                    targetKey = 'vt'; targetVal = total; 
                    explanation = "In Series, voltage adds up: <b>V<sub>T</sub> = V<sub>1</sub> + V<sub>2</sub></b>";
                } else if (unknown < 0.66) { 
                    targetKey = 'v1'; targetVal = v1; 
                    explanation = "In Series, voltage adds up. So, <b>V<sub>1</sub> = V<sub>T</sub> - V<sub>2</sub></b>";
                } else { 
                    targetKey = 'v2'; targetVal = v2; 
                    explanation = "In Series, voltage adds up. So, <b>V<sub>2</sub> = V<sub>T</sub> - V<sub>1</sub></b>";
                }
                unit = "V"; label = targetKey.toUpperCase().replace('T','t');
            } else {
                // I is constant
                const current = valA;
                it = i1 = i2 = current;
                // Randomly ask for one
                const unknown = Math.floor(Math.random() * 3);
                const keys = ['it', 'i1', 'i2'];
                targetKey = keys[unknown];
                targetVal = current;
                explanation = "In Series, there is only one path. Current is the SAME everywhere: <b>I<sub>T</sub> = I<sub>1</sub> = I<sub>2</sub></b>";
                unit = "A"; label = targetKey.toUpperCase().replace('T','t');
            }
        } else {
            // Parallel Logic
            if (isVoltage) {
                // V is constant
                const volt = valA * 2; // make it realistic
                total = v1 = v2 = volt;
                const unknown = Math.floor(Math.random() * 3);
                const keys = ['vt', 'v1', 'v2'];
                targetKey = keys[unknown];
                targetVal = volt;
                explanation = "In Parallel, branches connect to the same points. Voltage is the SAME: <b>V<sub>T</sub> = V<sub>1</sub> = V<sub>2</sub></b>";
                unit = "V"; label = targetKey.toUpperCase().replace('T','t');
            } else {
                // I adds up
                i1 = valA; i2 = valB; it = i1 + i2;
                const unknown = Math.random();
                if (unknown < 0.33) { 
                    targetKey = 'it'; targetVal = it; 
                    explanation = "In Parallel, current splits. Total is the sum: <b>I<sub>T</sub> = I<sub>1</sub> + I<sub>2</sub></b>";
                } else if (unknown < 0.66) { 
                    targetKey = 'i1'; targetVal = i1; 
                    explanation = "In Parallel, current splits. So, <b>I<sub>1</sub> = I<sub>T</sub> - I<sub>2</sub></b>";
                } else { 
                    targetKey = 'i2'; targetVal = i2; 
                    explanation = "In Parallel, current splits. So, <b>I<sub>2</sub> = I<sub>T</sub> - I<sub>1</sub></b>";
                }
                unit = "A"; label = targetKey.toUpperCase().replace('T','t');
            }
        }

        // Setup Object
        currentProblem = {
            type: type,
            targetVal: targetVal,
            explanation: explanation,
            unit: unit
        };

        // Render UI
        document.getElementById('mode-badge').innerText = `${type.toUpperCase()} CIRCUIT`;
        document.getElementById('mode-badge').style.color = isSeries ? 'var(--primary)' : 'var(--accent)';
        
        document.getElementById('input-label').innerHTML = `${label}<sub></sub> = `; // Clean label
        document.getElementById('unit-label').innerText = unit;

        const vals = {
            vt: isSeries && isVoltage ? (targetKey=='vt'?'?':total) : (isSeries?'-':(targetKey=='vt'?'?':total)),
            v1: isSeries && isVoltage ? (targetKey=='v1'?'?':v1) : (isSeries?'-':(targetKey=='v1'?'?':v1)),
            v2: isSeries && isVoltage ? (targetKey=='v2'?'?':v2) : (isSeries?'-':(targetKey=='v2'?'?':v2)),
            it: !isSeries && !isVoltage ? (targetKey=='it'?'?':it) : (!isSeries?'-':(targetKey=='it'?'?':it)),
            i1: !isSeries && !isVoltage ? (targetKey=='i1'?'?':i1) : (!isSeries?'-':(targetKey=='i1'?'?':i1)),
            i2: !isSeries && !isVoltage ? (targetKey=='i2'?'?':i2) : (!isSeries?'-':(targetKey=='i2'?'?':i2)),
        };

        // For constant values (like I in series), we need to fill the knowns even if they aren't calculated via addition
        if(isSeries && !isVoltage) { vals.it = (targetKey=='it'?'?':it); vals.i1 = (targetKey=='i1'?'?':i1); vals.i2 = (targetKey=='i2'?'?':i2); vals.vt='-'; vals.v1='-'; vals.v2='-'; }
        if(!isSeries && isVoltage) { vals.vt = (targetKey=='vt'?'?':total); vals.v1 = (targetKey=='v1'?'?':v1); vals.v2 = (targetKey=='v2'?'?':v2); vals.it='-'; vals.i1='-'; vals.i2='-'; }

        // Clean up dashes for SVG display (purely visual logic)
        // If we are testing Voltage, hide Current numbers to avoid confusion, and vice versa
        let displayVals = { ...vals };
        if (unit === 'V') { displayVals.it=''; displayVals.i1=''; displayVals.i2=''; }
        else { displayVals.vt=''; displayVals.v1=''; displayVals.v2=''; }

        const svgHTML = isSeries 
            ? getSeriesSVG(displayVals, targetKey) 
            : getParallelSVG(displayVals, targetKey);
            
        document.getElementById('circuit-canvas').innerHTML = svgHTML;
    }

    function checkAnswer() {
        if (!currentProblem) return;
        
        const userVal = parseFloat(document.getElementById('user-input').value);
        const feedback = document.getElementById('feedback-box');
        
        if (isNaN(userVal)) return;

        if (userVal === currentProblem.targetVal) {
            feedback.innerHTML = `<strong>Correct!</strong> üéâ <br> ${currentProblem.explanation}`;
            feedback.className = 'feedback-area correct';
            streak++;
            document.getElementById('next-btn').style.display = 'inline-block';
        } else {
            feedback.innerHTML = `<strong>Not quite.</strong> The answer is <strong>${currentProblem.targetVal}</strong>. <br> ${currentProblem.explanation}`;
            feedback.className = 'feedback-area wrong';
            streak = 0;
            document.getElementById('next-btn').style.display = 'inline-block';
        }
        document.getElementById('streak-display').innerText = streak;
    }

    // Init
    window.onload = () => {
        // Start in Learn mode
    };
</script>

</body>
</html>
